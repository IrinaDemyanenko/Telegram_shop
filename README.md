# Telegram_shop
Проект содержит код телеграмм - магазина, с БД, удобным меню, каталогом товаров, корзиной, блоком аналитики и отзывов. Магазин легко наполнить товарами и фотографиями прямо из магазина, перейдя по защищённым от простых посетителей маршрутам.

<b>Особенности магазина</b>

	Телеграм-магазин состоит из 3-х больших частей:
- интерфейс для пользователя (/menu);
- админ-панель (/admin-menu);
- база данных (PostgreSQL).

<b>Разграничение прав</b>

Модель User содержит поле role, которое чётко разделяет доступ к функциям магазина:

Visitor – обычный посетитель магазина, незарегистрированный в БД.
User – зарегистрированный пользователь (эта роль присваивается по умолчанию, при регистрации).
Admin – роль, которую может выдать суперпользователь, даёт доступ к админ-панели.
Superuser – имеет все перечисленные выше возможности, а так же может менять роли.

Такое разграничение реализовано, посредством декораторов KiprejBot/utils/role_decorator.py:
@admin_required
@superuser_required

Декораторы ограничивают доступ к командам Бота, которые можно сравнить с endpoints – если доступ разрешён, команда выполнится, если нет – появится уведомление об отсутствии прав.

Так же у админов и суперпользователя в основном меню, внизу, есть дополнительная кнопка – «Админ-панель». У посетителей и пользователей данная кнопка не отображается.

<b>Visitor</b>

Visitor – ключевая фигура магазина. Посетители могут просматривать следующие позиции главного меню: «Каталог», «Доставка и оплата», «Посмотреть корзину», «Контакты», «Регистрация».

При просмотре каталога и добавлении товаров в корзину, создаётся анонимная корзина.
Регистрация потребуется только на последнем этапе оформления заказа.
При оформлении заказа Бот проверяет зарегистрирован ли текущий посетитель по telegram_id, если нет – автоматически направляет на регистрацию.

Здесь происходит связь анонимной корзины и пользователя.

Такая концепция позволит не отпугнуть посетителя (редко кому хочется регистрироваться просто так), и его опыт будет позитивным.

<b>User</b>

В основном сценарии посетитель (не зарегистрирован) превращается в пользователя в момент оформления своего первого заказа. Но предусмотрена возможность зарегистрироваться сразу, по кнопке «Регистрация» в основном меню.

Пользователь может смотреть, изменять и удалять свои данные в «Профиле», а также отслеживать статус заказов в разделе «Мои заказы».

<b>База данных</b>

PostgreSQL, orm - SQLAlchemy, автоматизация миграций – Alembic.

Соединение с БД проброшено через middleware, чтобы было централизованное управление сессиями, единообразное и автоматическое закрытие соединений, централизованная обработка ошибок.
